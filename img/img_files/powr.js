!function(){var B="https://www.powr.io";function D(){return"http://localhost:3000"!=B&&"https://localhost:3000"!=B&&"http://10.0.2.2:3000"!=B&&"http://localhost:8888"!=B?function(){}:console.log.bind(window.console)}if("undefined"==typeof loadPowr){window.addEventListener?window.addEventListener("message",t):window.attachEvent("onmessage",t);var j=0;POWR_RECEIVERS=[];var n=document.createEvent("Event");n.initEvent("powrPingListener",!0,!0),loadPowr=function(){for(var t=null,e=null,n=null,o=!1,r=document.querySelectorAll("script"),a=0;a<r.length;a++){var i=r[a],l=i.getAttribute("src");if(null!=l){var d=i.getAttribute("powr-token"),s=i.getAttribute("external-type"),c=i.getAttribute("template-powr-token"),u=i.getAttribute("powr-load");if(null==u&&(u="async"),X()&&X()<=9&&(u="sync"),o=i.getAttribute("demo-mode"),null!=d?t=d:-1<l.search("powr-token")&&void 0!==(n=G(l))["powr-token"]&&0<n["powr-token"].length&&(t=n["powr-token"]),null!=s?e=s:-1<l.search("external-type")&&null!=(n=G(l))["external-type"]&&0<n["external-type"].length&&(e=n["external-type"]),null!=t||null!=e)break}}if(null==t||0==t.length)try{t=window.top.location.host}catch(e){t=""}var p=/\[powr-[^\]]*\]/gi,g=/\[powr-[^\s\]]*/gi,E=document.querySelectorAll("a");for(a=0;a<E.length;a++){if(!Y(R=E[a])){var w=R.previousSibling,m=R.nextSibling;if(w&&m&&R.getAttribute("href")&&-1<R.getAttribute("href").search("tel")&&3==w.nodeType&&3==m.nodeType&&w.nodeValue.match(g)&&-1<m.nodeValue.search("]")){var v=R.innerHTML,f=w.nodeValue.match(/powr-[^\s\]]*/gi)[0];(_=document.createElement("div")).innerHTML='<div class="'+f+'" label="'+v+'"></div>',w.parentNode.removeChild(w),m.parentNode.removeChild(m),R.parentNode.replaceChild(_,R)}}}for(E=document.querySelectorAll("body, body *"),a=0;a<E.length;a++){var R,h=(R=E[a]).childNodes;if(!Y(R))for(var y=0;y<h.length;y++){var C=h[y];if(3==C.nodeType){var _,S=C.nodeValue,b=S.replace(p,F);if(b!=S)(_=document.createElement("div")).innerHTML=b,R.replaceChild(_,C)}}}if(0==document.querySelectorAll("#powrIframeLoader").length){var I=document.createElement("div"),O=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];I.id="powrIframeLoader",I.innerHTML="&shy;<style> .powrLoaded iframe { visibility: hidden; } </style>",O.parentNode.insertBefore(I,O)}var P=document.querySelectorAll("[class*=powr-]"),W=!1;for(a=0;a<P.length;a++){var V=P[a];if(!Y(V)&&!(V instanceof SVGElement||-1<V.className.search("powrLoaded"))){var L=V.className.split(/\s+/);for(y=0;y<L.length;y++)if(0===L[y].toLowerCase().search("powr-")){var A=L[y].toLowerCase().replace("powr-","");break}if(void 0!==A){"popup"==A&&(W=!0);var x=V.getAttribute("label");if(null==x&&(x=""),"weebly_"!=x){V.className+=" powrLoaded",null==c&&(c="");var k=V.getAttribute("id");null==k&&(k="");var N=V.getAttribute("view-mode"),M="true"==o||"true"==V.getAttribute("demo-mode"),T=B+"/plugins/"+A+"/cached_view?load="+u+"&index="+j+"&unique_label="+k+"&powr_token="+t+"&user_label="+encodeURIComponent(x)+"&demo_mode="+M,q="https://www.powr.io/plugins/"+A+"/view.json?unique_label="+k+"&powr_token="+t+"&user_label="+encodeURIComponent(x)+"&demo_mode="+M;if(null!=e&&(q+="&external_type="+e,T+="&external_type="+e),null!=c&&(q+="&template_powr_token="+c,T+="&template_powr_token="+c),null!=N&&(q+="&view_mode="+N,T+="&view_mode="+N),D()("page url IS "+K()),K()&&(q+="&url="+encodeURIComponent(K())),document.location.host)var H=document.location.protocol+"//"+document.location.host;else try{H=document.location.ancestorOrigins[0]}catch(e){if(window.top&&window.top.location&&window.top.location.host)H=window.top.location.protocol+"//"+window.top.location.host;else H=""}q+="&request_url="+encodeURIComponent(H),T+=ee(V);var J=document.createElement("iframe");J.src=T,J.setAttribute("powrindex",j),J.width="100%",J.height="0px",J.style.height="0px",J.frameBorder="0",J.style.visibility="visible",J.setAttribute("webkitallowfullscreen",""),J.setAttribute("mozallowfullscreen",""),J.setAttribute("allowfullscreen","");try{/iPhone|iPod|iPad/.test(navigator.userAgent)&&(J.style.minWidth="100%",J.style.width="1px",J.setAttribute("scrolling","no"))}catch(e){console.log("Err: "+e)}Q(J,j,T),V.appendChild(J);var U=J.contentWindow;POWR_RECEIVERS.push({receiver:U,url:T,data_url:q}),"async"==u&&($(j),Z(j,J)),j++}}}}W&&(z(document,"click",function(e){var t=(e=e||window.event).relatedTarget||e.toElement||e.target;if(t&&t.classList.contains("trigger-popup"))for(var n=0;n<POWR_RECEIVERS.length;n++)POWR_RECEIVERS[n].receiver.postMessage(JSON.stringify({message:"triggerPowrPopupClick"}),POWR_RECEIVERS[n].url)}),z(document,"mouseout",function(e){if((e=e||window.event).clientY<5)for(var t=0;t<POWR_RECEIVERS.length;t++)POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"exitDocument"}),POWR_RECEIVERS[t].url)}))};for(var e=0;e<10;e++)setTimeout(function(){loadPowr()},2e3*e);z(window,"load",loadPowr);var o=!1;z(window,"keydown",function(e){if(80==e.keyCode&&(o=!0,setTimeout(function(){o=!1},2e3)),38==e.keyCode&&o){for(var t=0;t<POWR_RECEIVERS.length;t++)POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"showEdit"}),POWR_RECEIVERS[t].url);return e.preventDefault(),!1}if(40==e.keyCode&&o){for(t=0;t<POWR_RECEIVERS.length;t++)POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"hideEdit"}),POWR_RECEIVERS[t].url);return e.preventDefault(),!1}})}else D()("Powr already loaded");function z(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function F(e,t,n,o,r,a){var i=e;D()("Match:",e);var l=i.match(/powr-[^\s\]]*/i),d=i.match(/id="[^"]*"/i);null==d&&(d=i.match(/id='[^']*'/i)),null==d&&null!=(d=i.match(/id=[^\]]*/i))&&(d=d[0].replace("id=",'id="')+'"'),null==d&&(d=i.match(/label="[^"]*"/i)),null==d&&(d=i.match(/label='[^']*'/i)),null==d&&(d="");var s='<div class="'+l+'" '+d+"></div>";return D()("Result is:"+s),s}function G(e){for(var t={},n=e.search("\\?"),o=(e=e.substr(n+1)).split("&"),r=0;r<o.length;r++){var a=o[r].split("=");if(void 0===t[a[0]])t[a[0]]=a[1];else if("string"==typeof t[a[0]]){var i=[t[a[0]],a[1]];t[a[0]]=i}else t[a[0]].push(a[1])}return t}function X(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")&&parseInt(e.split("msie")[1])}function Y(e){for(var t=!1,n=e;n&&n!==document;n=n.parentNode)if(null!=n.classList&&n.classList.contains("powr-ignore")){t=!0;break}return t}function K(){try{return window.top.location.href}catch(e){return D()("Couldn't get page url:",e),""}}function Q(t,n,o){function e(){var e={message:"loaded",data:{iframe_index:n,parent_window_width:window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth,parent_window_height:window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight}};D()("POWr.js sending load message to url"+o+"; iframe:",t),t.contentWindow.postMessage(JSON.stringify(e),o)}t.addEventListener?t.addEventListener("load",e):t.attachEvent("onload",e)}function Z(t,e){e.addEventListener&&(e.addEventListener("powrPingListener",function(){return POWR_RECEIVERS[t].listenerConnected=!0},!1),POWR_RECEIVERS[t].ping_interval=setInterval(function(){var e=document.querySelectorAll('[powrindex="'+t+'"]')[0];e&&(POWR_RECEIVERS[t].listenerConnected=!1,e.dispatchEvent(n),!1===POWR_RECEIVERS[t].listenerConnected&&(console.log("POWr Lost connection. Reconnecting"),clearInterval(POWR_RECEIVERS[t].ping_interval),POWR_RECEIVERS[t].receiver=e.contentWindow,$(t),Z(t,e)))},2e3))}function $(n){var o=new XMLHttpRequest;o.open("GET",POWR_RECEIVERS[n].data_url,!0),o.withCredentials=!0,o.onreadystatechange=function(){if(D()("Async ready state change!",o),o.readyState==XMLHttpRequest.DONE||4==o.readyState)if(200==o.status){var e=JSON.parse(o.responseText);e.iframe_index=n,POWR_RECEIVERS[n].data=e;var t=setInterval(function(){POWR_RECEIVERS[n].loaded&&(POWR_RECEIVERS[n].receiver.postMessage(JSON.stringify({message:"loadView",data:e}),POWR_RECEIVERS[n].url),clearInterval(t))},10)}else D()("Error receiving POWr App Data")},o.send()}function ee(e){for(var t=window.getComputedStyle(e),n=e,o=t.backgroundColor;("rgba(0, 0, 0, 0)"==o||"transparent"==o)&&n.parentElement;)n=n.parentElement,o=window.getComputedStyle(n).backgroundColor;return"&color="+encodeURIComponent(t.color)+"&backgroundColor="+encodeURIComponent(o)+"&fontFamily="+encodeURIComponent(t.fontFamily)}function t(e){D()("Settings got a message!",e);try{var t=JSON.parse(e.data);if("viewLoaded"==t.message){D()("Settings received view loaded");var n=t.data.iframe_index;POWR_RECEIVERS[n].loaded=!0}else if("updateSize"==t.message){"undefined"!=typeof gadgets&&void 0!==gadgets.window&&void 0!==gadgets.window.adjustHeight&&gadgets.window.adjustHeight(t.data.height);n=t.data.iframe_index;var o=document.querySelectorAll('[powrindex="'+n+'"]')[0];if(o&&(o.height=t.data.height+"px",o.style.height=t.data.height+"px",null!=t.data.postCss))for(var r in t.data.postCss)o.style[r]=t.data.postCss[r];D()("Updating size of el",o)}else if("loadMe"==t.message){D()("Settings received loadMe request");n=t.data.iframe_index;null!=POWR_RECEIVERS[n]&&null!=POWR_RECEIVERS[n].data&&POWR_RECEIVERS[n].receiver.postMessage(JSON.stringify({message:"loadView",data:POWR_RECEIVERS[n].data}),POWR_RECEIVERS[n].url)}}catch(e){}}}();
